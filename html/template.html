<html>
  <head>
    <style>
      body {font-family:"Arial", "Helvetica", "Verdana", "Calibri", sans-serif; hyphens:manual;}
      table,th,tr,td {border:0; padding:0; margin:0; border-collapse:collapse; text-align:center; align:center;}
      td {padding:0.3em; border:1px solid black;}
      th {padding:0.5em; border:1px solid black;}
      .rssi {width:100%; padding:0; height:14pt;}
      .weak {background-color:orange}
      .good {background-color:grey}
      .best {background-color:green}
      .no-borders {border:0;}
      .no-padding {padding:0;}
      .right {text-align:right;}
      .left {text-align:left;}
      .left-tight {text-align:left;border:0;}
      .health {height:50px; width:250px; font-size:90%;}
      .small {font-size:80%;}
      .report {font-size:80%;border:0;}
      .down {color:red;}
      .unknown {color:orange;}
      .up {color:green;}
      .retire {color:grey; font-style:italic}
      .disk-low {color:red; font-style:bold}
    </style>

    <script>
      function checkPage() {
          const DayOfWeek = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
          const MonthName = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

          let refreshPromise = new Promise(
              function(result, reject) {
                  // This is really painful...
                  // If-Modified-Since: <day-name>, <day> <month-name> <year> <hour>:<minute>:<second> GMT
		  let docRequestedDate = new Date(document.lastModified);
                  let docRequestedHTTPString =
                      DayOfWeek[docRequestedDate.getUTCDay()] + ", " +
                      docRequestedDate.getUTCDate().toString().padStart(2, "0") + " " +
                      MonthName[docRequestedDate.getUTCMonth()] + " " +
                      docRequestedDate.getUTCFullYear().toString() + " " +
                      docRequestedDate.getUTCHours().toString().padStart(2, "0") + ":" +
                      docRequestedDate.getUTCMinutes().toString().padStart(2, "0") + ":" +
                      docRequestedDate.getUTCSeconds().toString().padStart(2, "0") + " GMT";

                  var http = new XMLHttpRequest();
                  http.open("HEAD", document.URL);
                  http.setRequestHeader("If-Modified-Since", docRequestedHTTPString);
                  http.onreadystatechange = function() {
                      if (this.readyState == this.DONE) {
                          result(this.status);
                      }
                  }
                  http.send();
              }
          );

          refreshPromise.then(
              function(status) {
                  if (status == 200) {
                      location.reload(true);
                  } else {
                      setupPromise();
                  }
              }
          );
      }

      function setupPromise() {
          setTimeout(checkPage, 1000);
      }

      function sortTable(n) {
          var table, rows, switching, i, x, y, shouldSwitch;
          table = document.getElementById("actimetres");
          switching = true;
          /*Make a loop that will continue until
            no switching has been done:*/
          while (switching) {
              //start by saying: no switching is done:
              switching = false;
              rows = table.rows;
              /*Loop through all table rows (except the
                first, which contains table headers):*/
              for (i = 1; i < (rows.length - 1); i++) {
                  //start by saying there should be no switching:
                  shouldSwitch = false;
                  /*Get the two elements you want to compare,
                    one from current row and one from the next:*/
                  x = rows[i].getElementsByTagName("TD")[n];
                  y = rows[i + 1].getElementsByTagName("TD")[n];
                  /*check if the two rows should switch place */
                  if (x.dataset.comparator > y.dataset.comparator) {
                      //if so, mark as a switch and break the loop:
                      shouldSwitch= true;
                      break;
                  }
              }
              if (shouldSwitch) {
                  /*If a switch has been marked, make the switch
                    and mark that a switch has been done:*/
                  rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                  switching = true;
              }
          }
      }
      
      window.addEventListener("load", setupPromise);

    </script>
    
    <title>Actimetre Dashboard</title>
    <link rel="icon" type="image/svg" href="/actimetre.svg">
  </head>

  <body>
    <p class="log" id="log"></p>
    
    <h1>Projects</h1>
    <table>
      <tr>
	<th>Title</th>
	<th>Owner</th>
	<th>Actimetres</th>
      </tr>
      {Projects}
    </table>
    
    <h1>Servers</h1>
    <p><a href="/servers.html">Full list</a></p>
    <table>
      <tr>
	<th>Name</th>
	<th>Hardware</th>
	<th>Version<br>Channel</th>
	<th>Last update</th>
	<th>Stats</th>
	<th>Actimetres</th>
        <th>Local files</th>
        <th>Disk space</th>
      </tr>
      {Actiservers}
    </table>
    
    <form action="/bin/{cgi-bin}" method="get">
      <p><button type="submit" name="action" value="project-create">Create a new project</button></p>
    </form>

    <h1>Actimetres</h1>
    <p><a href="/actims-free.html">Available Actimetres</a> |
        <a href="/actims.html">Full List</a></p>

    <hr width="100%">
    <div style="float:left">All times in UTC &ndash;
      Last updated:
      {Updated}
    </div>
    <div style="float:right"><a href="/admin.html"><img height="20px" src="/actimetre.svg" style="vertical-align:middle"></a>
      <a href="/acknowledgments.html">Acticentral
	{Version}
    </a></div>
  </body>
</html>
